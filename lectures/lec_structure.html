<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-00b3e0f491c887a031945d3e0bd25d56.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.8.24">

  <title>Decision Analysis Workshop – Structuring a Markov Model</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #cbccc6; background-color: #1f2430; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #cbccc6; } /* Normal */
    code span.al { color: #ff3333; background-color: #332430; font-weight: bold; } /* Alert */
    code span.an { color: #ffe6b3; } /* Annotation */
    code span.at { color: #73d0ff; } /* Attribute */
    code span.bn { color: #ffcc66; } /* BaseN */
    code span.bu { color: #95e6cb; } /* BuiltIn */
    code span.cf { color: #ffa759; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #95e6cb; } /* Char */
    code span.cn { color: #d4bfff; } /* Constant */
    code span.co { color: #5c6773; font-style: italic; } /* Comment */
    code span.cv { color: #d4bfff; } /* CommentVar */
    code span.do { color: #5c6773; } /* Documentation */
    code span.dt { color: #ffa759; } /* DataType */
    code span.dv { color: #ffcc66; } /* DecVal */
    code span.er { color: #ff3333; text-decoration: underline; } /* Error */
    code span.ex { color: #73d0ff; font-weight: bold; } /* Extension */
    code span.fl { color: #ffcc66; } /* Float */
    code span.fu { color: #ffd580; } /* Function */
    code span.im { color: #bae67e; } /* Import */
    code span.in { color: #ffcc66; } /* Information */
    code span.kw { color: #ffa759; font-weight: bold; } /* Keyword */
    code span.op { color: #f29e74; } /* Operator */
    code span.ot { color: #5ccfe6; } /* Other */
    code span.pp { color: #f28779; } /* Preprocessor */
    code span.re { color: #73d0ff; background-color: #2a4254; } /* RegionMarker */
    code span.sc { color: #95e6cb; } /* SpecialChar */
    code span.ss { color: #95e6cb; } /* SpecialString */
    code span.st { color: #bae67e; } /* String */
    code span.va { color: #5ccfe6; } /* Variable */
    code span.vs { color: #bae67e; } /* VerbatimString */
    code span.wa { color: #f28779; } /* Warning */
    /* CSS for citations */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
      margin-bottom: 0em;
    }
    .hanging-indent div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-0667623e39e345170d362296defe6630.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
  <link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Structuring a Markov Model</h1>

<div class="quarto-title-authors">
</div>

</section>
<section class="slide level2">

<style>
.nobullet li {
  list-style-type: none;
}
</style>
</section>
<section>
<section id="learning-objectives-and-outline" class="title-slide slide level1 center">
<h1>Learning Objectives and Outline</h1>
<!-- Rates: The instantaneous potential for the occurrence of an event, expressed per number of patients at risk. Rates can be added and subtracted. -->
<!-- Probabilities: A number ranging between 0 and 1. Represents the likelihood of an event happening over a specific period of time. -->
<!-- https://www.hsrd.research.va.gov/for_researchers/cyber_seminars/archives/2401-notes.pdf -->
<!-- https://link.springer.com/article/10.1007/s40273-020-00937-z -->
<!-- https://www.valueinhealthjournal.com/article/S1098-3015(12)01654-3/fulltext?_returnURL=https%3A%2F%2Flinkinghub.elsevier.com%2Fretrieve%2Fpii%2FS1098301512016543%3Fshowall%3Dtrue -->
</section>
<section id="learning-objectives" class="slide level2">
<h2>Learning Objectives</h2>
<ul>
<li class="fragment">Understand differences between rates and probabilities, hazard rates, relative risks, and other relevant model inputs.</li>
<li class="fragment">Understand rate-to-probability conversion formulas and transition probability embedding.</li>
<li class="fragment">Explain how to embed a transition probability matrix with a defined timestep.</li>
<li class="fragment">Explore age-, time- and country/region-specific adjustments to a Markov model.</li>
</ul>
</section></section>
<section>
<section id="outline" class="title-slide slide level1 smaller center">
<h1>Outline</h1>
<ol type="1">
<li class="fragment">Rates, probabilities, and other model inputs.</li>
<li class="fragment">Constructing the transition probability matrix.</li>
<li class="fragment">Model dynamics</li>
</ol>
<ul>
<li class="fragment">Non-stationary rates: mortality and other time/age-varying parameters.</li>
<li class="fragment">Tunnel states and other disease-specific transition dynamics</li>
</ul>
</section>
<section id="goal" class="slide level2">
<h2>Goal</h2>

<img data-src="images/paste-DE23E852.png" class="r-stretch"></section>
<section id="what-never-happens" class="slide level2">
<h2>What <em>Never</em> Happens</h2>

<img data-src="images/paste-35C55E40.png" class="r-stretch"></section>
<section id="problem" class="slide level2">
<h2>Problem</h2>
<ul>
<li class="fragment">Need transition probabilities but literature-based parameters are reported as:</li>
</ul>
<ol type="1">
<li class="fragment">Rates</li>
<li class="fragment">Hazard ratios</li>
<li class="fragment">Odds ratios</li>
<li class="fragment">Relative risks</li>
<li class="fragment">Transition probabilities (rare!)</li>
</ol>
</section></section>
<section>
<section id="how-can-we-deal-with-this" class="title-slide slide level1 center" data-background="#c2f0c2">
<h1>How can we deal with this?</h1>

</section>
<section id="solution" class="slide level2">
<h2>Solution</h2>
<ul>
<li class="fragment">Need “common ground” where we can combine and transform different model inputs.</li>
<li class="fragment">This “common ground” is often found in a <strong>transition rate matrix.</strong></li>
</ul>
</section>
<section id="solution-1" class="slide level2">
<h2>Solution</h2>

<img data-src="images/paste-23D41BA7.png" class="r-stretch"></section>
<section id="solution-2" class="slide level2">
<h2>Solution</h2>

<img data-src="images/paste-7BE7C6AF.png" class="r-stretch"></section>
<section id="solution-3" class="slide level2">
<h2>Solution</h2>

<img data-src="images/paste-EFB5816C.png" class="r-stretch"></section>
<section id="solution-4" class="slide level2">
<h2>Solution</h2>

<img data-src="images/paste-500FB9B7.png" class="r-stretch"></section>
<section id="transition-rate-matrix" class="slide level2" data-background-image="images/paste-7BE7C6AF.png" data-background-size="contain" data-background-opacity="0.2">
<h2>Transition Rate Matrix</h2>
<ul>
<li class="fragment">The central “hub” of a Markov model.</li>
<li class="fragment">Straightforward to convert rate matrix into a transition probability matrix.</li>
<li class="fragment">Can be used to change the cycle length.</li>
<li class="fragment">Facilitates modeling using alternative techniques:
<ul>
<li class="fragment">Continuous time Markov</li>
<li class="fragment">Discrete event simulation</li>
</ul></li>
</ul>
</section>
<section id="four-step-process" class="slide level2">
<h2>Four-Step Process</h2>
<ol type="1">
<li class="fragment">Use data inputs/published literature to define a rate matrix <span class="math inline">\(\mathbf{R}\)</span>.</li>
<li class="fragment">Make strategy-specific adjustments to <span class="math inline">\(\mathbf{R}\)</span> as needed.</li>
<li class="fragment">“Embed” the transition probability matrix using the rate matrix</li>
<li class="fragment">Make further overall or strategy-specific adjustments to <span class="math inline">\(\mathbf{P}\)</span> as needed.</li>
</ol>
</section></section>
<section>
<section id="what-is-the-difference-between-a-rate-and-a-probability" class="title-slide slide level1 center" data-background="#c2f0c2">
<h1>What is the difference between a rate and a probability?</h1>

</section>
<section id="rates-vs.-probabilities" class="slide level2">
<h2>Rates vs.&nbsp;Probabilities</h2>
<ul>
<li class="fragment"><strong>Rate</strong>: number of occurrences of an event per unit of time.</li>
<li class="fragment"><strong>Probability</strong>: Liklihood that an event will occur for an in individual over a defined time period.</li>
<li class="fragment">Major difference is in denominator: rates take into account <strong>time at risk</strong> while probabilities do not.</li>
</ul>
</section>
<section id="rates-vs.-probabilities-1" class="slide level2">
<h2>Rates vs.&nbsp;Probabilities</h2>

<img data-src="images/paste-83525383.png" class="r-stretch"></section>
<section id="rates" class="slide level2">
<h2>Rates</h2>
<ul>
<li class="fragment">Number of events divided by the total time at risk experienced by all people followed.</li>
<li class="fragment">Ranges from 0 to <span class="math inline">\(\infty\)</span>.</li>
<li class="fragment"><span class="math inline">\(\frac{\# \text{events in time period}}{\text{Total time period experienced by all subjects followed}}\)</span></li>
</ul>
</section>
<section id="rates-1" class="slide level2">
<h2>Rates</h2>

<img data-src="images/paste-8191B0E3.png" class="r-stretch"></section>
<section id="probabilities" class="slide level2">
<h2>Probabilities</h2>

<img data-src="images/paste-62FF1911.png" class="r-stretch"></section>
<section id="rates-vs.-probabilities-example1" class="slide level2">
<h2>Rates vs.&nbsp;Probabilities: Example<sup>1</sup></h2>
<ul>
<li class="fragment">Suppose a study followed 100 people with congestive heart failure for 4 years.</li>
<li class="fragment">At the end of 4 years, 40 had died.</li>
<li class="fragment">The probability of death over 4 years is <span class="math inline">\(40/100=0.40\)</span>.</li>
</ul>
<aside><ol class="aside-footnotes"><li id="fn1"><p>Source: <span class="citation" data-cites="gidwaniEstimatingTransitionProbabilities2020">Gidwani and Russell (<a href="#/references" role="doc-biblioref" onclick="">2020</a>)</span></p></li></ol></aside></section>
<section id="rates-vs.-probabilities-example2" class="slide level2">
<h2>Rates vs.&nbsp;Probabilities: Example<sup>1</sup></h2>
<ul>
<li class="fragment">A rate takes into acccount the time each person was at risk.</li>
<li class="fragment">The 60 who survived were at risk the entire 4 years and contributed <span class="math inline">\(60 \times 4 = 240\)</span> years at risk.</li>
<li class="fragment">Once a person dies, he/she is no longer at risk.</li>
</ul>
<aside><ol class="aside-footnotes"><li id="fn2"><p>Source: <span class="citation" data-cites="gidwaniEstimatingTransitionProbabilities2020">Gidwani and Russell (<a href="#/references" role="doc-biblioref" onclick="">2020</a>)</span></p></li></ol></aside></section>
<section id="rates-vs.-probabilities-example3" class="slide level2">
<h2>Rates vs.&nbsp;Probabilities: Example<sup>1</sup></h2>
<ul>
<li class="fragment">When a study does not report time at risk, the conventional assumption is that the events were spread evenly over the time period.</li>
<li class="fragment">Using this assumption, the average time at risk for the 40 who died was 2 years, adding 40 × 2 = 80 years at risk.</li>
</ul>
<aside><ol class="aside-footnotes"><li id="fn3"><p>Source: <span class="citation" data-cites="gidwaniEstimatingTransitionProbabilities2020">Gidwani and Russell (<a href="#/references" role="doc-biblioref" onclick="">2020</a>)</span></p></li></ol></aside></section>
<section id="rates-vs.-probabilities-example4" class="slide level2">
<h2>Rates vs.&nbsp;Probabilities: Example<sup>1</sup></h2>
<ul>
<li class="fragment">Total time at risk for the cohort of 100 people is 320 person-years (240+80).</li>
<li class="fragment">Thus, the rate of death from CHF is 40/320 = 0.125 deaths per person-year.</li>
<li class="fragment">Let’s now construct a rate matrix with three states: CHF, Death from CHF, and Death from other causes.</li>
</ul>
<aside><ol class="aside-footnotes"><li id="fn4"><p>Source: <span class="citation" data-cites="gidwaniEstimatingTransitionProbabilities2020">Gidwani and Russell (<a href="#/references" role="doc-biblioref" onclick="">2020</a>)</span></p></li></ol></aside></section>
<section id="rates-vs.-probabilities-example" class="slide level2">
<h2>Rates vs.&nbsp;Probabilities: Example</h2>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">CHF</th>
<th style="text-align: right;">D_CHF</th>
<th style="text-align: right;">D_OTH</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CHF</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">D_CHF</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">D_OTH</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="rates-vs.-probabilities-example-1" class="slide level2">
<h2>Rates vs.&nbsp;Probabilities: Example</h2>
<ul>
<li class="fragment">0.125 per person year is the <strong>rate</strong> we’d enter into our rate matrix.</li>
<li class="fragment">We could also think of a separate death rate from background causes (e.g., 0.006 per person-year).<sup>1</sup></li>
</ul>
<aside><ol class="aside-footnotes"><li id="fn5"><p>This often comes from separate vital statistics / life-table data sources.</p></li></ol></aside></section>
<section id="rates-vs.-probabilities-example-2" class="slide level2">
<h2>Rates vs.&nbsp;Probabilities: Example</h2>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">CHF</th>
<th style="text-align: right;">D_CHF</th>
<th style="text-align: right;">D_OTH</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CHF</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.125</td>
<td style="text-align: right;">0.006</td>
</tr>
<tr class="even">
<td style="text-align: left;">D_CHF</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">D_OTH</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="rates-vs.-probabilities-example-3" class="slide level2 smaller">
<h2>Rates vs.&nbsp;Probabilities: Example</h2>
<div class="columns">
<div class="column">
<ul>
<li class="fragment">The diagonal elements in a rate matrix are just the negative sum of the off-diagonal elements.</li>
<li class="fragment">In this example, the diagonal value for the 1st row would be -0.131 = -(0.125+0.006)</li>
<li class="fragment">We can leave all other rate matrix values at 0 because the rate of progression from death to other states is zero.</li>
</ul>
</div><div class="column">
<div style="padding-top: 125px; font-size: 0.8em">
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top" style="margin-left: auto; margin-right: auto;">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">CHF</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Death_CHF</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Death_Other</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CHF</td>
<td style="text-align: left;"><span style="     color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: red !important;">-0.131</span></td>
<td style="text-align: right;">0.125</td>
<td style="text-align: right;">0.006</td>
</tr>
<tr class="even">
<td style="text-align: left;">Death_CHF</td>
<td style="text-align: left;"><span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span></td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Death_Other</td>
<td style="text-align: left;"><span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span></td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div></div>
</section>
<section id="summary-rates-vs.-probabilities" class="slide level2">
<h2>Summary: Rates vs.&nbsp;Probabilities</h2>
<div style="font-size: 0.6em">
<table class="caption-top">
<colgroup>
<col style="width: 15%">
<col style="width: 54%">
<col style="width: 15%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th>Statistic</th>
<th>Evaluates</th>
<th>Range</th>
<th>Applicable Domain</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Rate</td>
<td><span class="math inline">\(\frac{\# \text{events in time period}}{\text{Total time period experienced by all subjects followed}}\)</span></td>
<td>0 to <span class="math inline">\(\infty\)</span></td>
<td>Rate matrix</td>
</tr>
<tr class="even">
<td>Probability/risk</td>
<td><span class="math inline">\(\frac{\# \text{events in time period}}{\# \text{people followed for time period}}\)</span></td>
<td>0-1</td>
<td>Probability matrix</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="place-rates-in-a-rate-matrix-mathbfr." class="slide level2">
<h2>1. Place rates in a rate matrix <span class="math inline">\(\mathbf{R}\)</span>.</h2>

<img data-src="images/paste-01DABA0F.png" class="r-stretch"></section>
<section id="place-rates-in-a-rate-matrix-mathbfr.-1" class="slide level2 smaller">
<h2>1. Place rates in a rate matrix <span class="math inline">\(\mathbf{R}\)</span>.</h2>
<div class="columns">
<div class="column">
<ul>
<li class="fragment">Country/region-specific background mortality rate (0.006)</li>
<li class="fragment">Disease mortality rates from existing population-based epidemiological study. (e.g., 0.125 = 40 cases per 320 person-years)</li>
<li class="fragment">Diagonal value that is the negative sum of the off-diagonal values in each row (-0.131).</li>
</ul>
</div><div class="column">
<div style="padding-top: 125px; font-size: 0.8em">
<p>“Natural History” (i.e., “do nothing”) rate matrix:</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">CHF</th>
<th style="text-align: right;">Death_CHF</th>
<th style="text-align: right;">Death_Other</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CHF</td>
<td style="text-align: right;">-0.131</td>
<td style="text-align: right;">0.125</td>
<td style="text-align: right;">0.006</td>
</tr>
<tr class="even">
<td style="text-align: left;">Death_CHF</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Death_Other</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div></div>
</section>
<section id="place-rates-in-a-rate-matrix-mathbfr.-2" class="slide level2">
<h2>1. Place rates in a rate matrix <span class="math inline">\(\mathbf{R}\)</span>.</h2>
<ul>
<li class="fragment">What we have just done is contruct a rate matrix for a “natural history” model of the disease (CHF).</li>
<li class="fragment">This is a version of the model in which we allow the disease process to play out naturally, with no further intervention.</li>
<li class="fragment">Sometimes called a “do nothing” strategy.</li>
</ul>
</section>
<section id="place-rates-in-a-rate-matrix-mathbfr.-3" class="slide level2">
<h2>1. Place rates in a rate matrix <span class="math inline">\(\mathbf{R}\)</span>.</h2>
<ul>
<li class="fragment">The “natural history” model is useful because it can help us verify that the model matches what we see in the “real world.”</li>
<li class="fragment">The “natural history” model also can be used to calibrate transition rates to different countries/contexts.</li>
<li class="fragment">For example, we could recalibrate the model so the CHF mortality transition rate matches our country-specific data.</li>
</ul>
</section>
<section id="place-rates-in-a-rate-matrix-mathbfr.-4" class="slide level2">
<h2>1. Place rates in a rate matrix <span class="math inline">\(\mathbf{R}\)</span>.</h2>
<ul>
<li class="fragment">Alternatively, suppose we “borrow” a model developed in another country/context.</li>
<li class="fragment">That model will be based on underlying rates specific to that context.</li>
<li class="fragment">The underlying rate matrix can be used to “swap in” transition rates that apply to our country/context.
<ul>
<li class="fragment">Example: change the background mortality rate to match you country’s.</li>
</ul></li>
</ul>
</section>
<section id="make-adjustments-to-mathbfr-as-needed." class="slide level2">
<h2>2. Make adjustments to <span class="math inline">\(\mathbf{R}\)</span> as needed.</h2>

<img data-src="images/paste-20350F55.png" class="r-stretch"></section>
<section id="make-adjustments-to-mathbfr-as-needed.-1" class="slide level2 smaller">
<h2>2. Make adjustments to <span class="math inline">\(\mathbf{R}\)</span> as needed.</h2>
<div class="columns">
<div class="column">
<ul>
<li class="fragment">Suppose that a new strategy can reduces the risk of CHF mortality by 20% (i.e., hazard ratio = 0.8).</li>
<li class="fragment">We can simply apply this hazard ratio directly to construct a rate matrix for strategy A.</li>
<li class="fragment">For the Strategy A rate matrix, the rate of CHF death is <span class="math inline">\(0.8 * 0.125 = 0.1\)</span></li>
<li class="fragment">Make sure that the diagonal element is adjusted to account for this change!</li>
</ul>
</div><div class="column">
<div style="font-size: 0.8em">
<p>“Natural History” rate matrix</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">CHF</th>
<th style="text-align: right;">Death_CHF</th>
<th style="text-align: right;">Death_Other</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CHF</td>
<td style="text-align: right;">-0.131</td>
<td style="text-align: right;">0.125</td>
<td style="text-align: right;">0.006</td>
</tr>
<tr class="even">
<td style="text-align: left;">Death_CHF</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Death_Other</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div></div>
</section>
<section id="make-adjustments-to-mathbfr-as-needed.-2" class="slide level2 smaller">
<h2>2. Make adjustments to <span class="math inline">\(\mathbf{R}\)</span> as needed.</h2>
<div class="columns">
<div class="column">
<div style="font-size: 1.0em">
<ul>
<li>Suppose that a new strategy can reduces the risk of CHF mortality by 20% (i.e., hazard ratio = 0.8).</li>
<li>We can simply apply this hazard ratio directly to construct a rate matrix for strategy A.</li>
<li>For the Strategy A rate matrix, the rate of CHF death is <span class="math inline">\(0.8 * 0.125 = 0.1\)</span></li>
<li>Make sure that the diagonal element is adjusted to account for this change!</li>
</ul>
</div>
</div><div class="column">
<div style="font-size: 0.8em">
<p>“Natural History” rate matrix</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">CHF</th>
<th style="text-align: right;">Death_CHF</th>
<th style="text-align: right;">Death_Other</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CHF</td>
<td style="text-align: right;">-0.131</td>
<td style="text-align: right;">0.125</td>
<td style="text-align: right;">0.006</td>
</tr>
<tr class="even">
<td style="text-align: left;">Death_CHF</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Death_Other</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>“Strategy A” rate matrix</p>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top" style="margin-left: auto; margin-right: auto;">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">CHF</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Death_CHF</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Death_Other</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CHF</td>
<td style="text-align: left;"><span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: red !important;">-0.106</span></td>
<td style="text-align: left;"><span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: red !important;">0.1</span></td>
<td style="text-align: right;">0.006</td>
</tr>
<tr class="even">
<td style="text-align: left;">Death_CHF</td>
<td style="text-align: left;"><span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span></td>
<td style="text-align: left;"><span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span></td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Death_Other</td>
<td style="text-align: left;"><span style=" font-weight: bold;    color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span></td>
<td style="text-align: left;"><span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span></td>
<td style="text-align: right;">0.000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div></div>
</section>
<section id="make-adjustments-to-mathbfr-as-needed.-3" class="slide level2 smaller">
<h2>2. Make adjustments to <span class="math inline">\(\mathbf{R}\)</span> as needed.</h2>
<div class="columns">
<div class="column">
<ul>
<li class="fragment">Another adjustment we could make at this stage is the time cycle length.</li>
<li class="fragment">Suppose our rate matrix is defined in terms of a one-year time cycle, but we want to convert to a monthly cycle.</li>
<li class="fragment">In that event, we’d simply divide each rate in the matrix by 12, and the resulting matrix would be for a monthly timestep.</li>
</ul>
</div><div class="column">
<div style="font-size: 0.8em">
<p>“Natural History” rate matrix (one-year timestep)</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">CHF</th>
<th style="text-align: right;">Death_CHF</th>
<th style="text-align: right;">Death_Other</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CHF</td>
<td style="text-align: right;">-0.131</td>
<td style="text-align: right;">0.125</td>
<td style="text-align: right;">0.006</td>
</tr>
<tr class="even">
<td style="text-align: left;">Death_CHF</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Death_Other</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div></div>
</section>
<section id="make-adjustments-to-mathbfr-as-needed.-4" class="slide level2 smaller">
<h2>2. Make adjustments to <span class="math inline">\(\mathbf{R}\)</span> as needed.</h2>
<div class="columns">
<div class="column">
<ul>
<li>Another adjustment we could make at this stage is the time cycle length.</li>
<li>Suppose our rate matrix is defined in terms of a one-year time cycle, but we want to convert to a monthly cycle.</li>
<li>In that event, we’d simply divide each rate in the matrix by 12, and the resulting matrix would be for a monthly timestep.</li>
</ul>
</div><div class="column">
<div style="font-size: 0.8em">
<p>“Natural History” rate matrix (one-year timestep)</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">CHF</th>
<th style="text-align: right;">Death_CHF</th>
<th style="text-align: right;">Death_Other</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CHF</td>
<td style="text-align: right;">-0.131</td>
<td style="text-align: right;">0.125</td>
<td style="text-align: right;">0.006</td>
</tr>
<tr class="even">
<td style="text-align: left;">Death_CHF</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Death_Other</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>“Natural History” rate matrix (one-month timestep)</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">CHF</th>
<th style="text-align: left;">Death_CHF</th>
<th style="text-align: left;">Death_Other</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CHF</td>
<td style="text-align: left;">-0.0109</td>
<td style="text-align: left;">0.0104</td>
<td style="text-align: left;">5e-04</td>
</tr>
<tr class="even">
<td style="text-align: left;">Death_CHF</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Death_Other</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div></div>
</section>
<section id="embed-the-transition-probability-matrix-using-the-rate-matrix" class="slide level2">
<h2>3. “Embed” the transition probability matrix using the rate matrix</h2>

<img data-src="images/paste-CC9FEF98.png" class="r-stretch"></section>
<section id="embed-the-transition-probability-matrix-using-the-rate-matrix-1" class="slide level2">
<h2>3. “Embed” the transition probability matrix using the rate matrix</h2>
<ul>
<li class="fragment">Our next step is to convert the transition rate matrix into a transition probability matrix.</li>
<li class="fragment">Common practice is to use rate-to-probability conversion formulas</li>
</ul>
</section>
<section id="embed-the-transition-probability-matrix-using-the-rate-matrix-2" class="slide level2">
<h2>3. “Embed” the transition probability matrix using the rate matrix</h2>
<ul>
<li>Our next step is to convert the transition rate matrix into a transition probability matrix.</li>
<li>Common practice is to use rate-to-probability conversion formulas</li>
</ul>
<p><span class="math display">\[
p = 1 - \exp(-rt)
\]</span> where <span class="math inline">\(r\)</span> is the rate and <span class="math inline">\(t\)</span> is the time-step.</p>
</section>
<section id="embed-the-transition-probability-matrix-using-the-rate-matrix-3" class="slide level2">
<h2>3. “Embed” the transition probability matrix using the rate matrix</h2>
<ul>
<li class="fragment">This formula works fine when there is only one possible state an individual can transition to.</li>
<li class="fragment">The formula <strong>will not</strong> calculate the correct transition probability if there are two or more states someone can transition to. <!-- -   See the [workshop blog posting](../blog/posts/embedding-a-transition-probability-matrix.html) for more. --></li>
</ul>
</section>
<section id="embed-the-transition-probability-matrix-using-the-rate-matrix-4" class="slide level2">
<h2>3. “Embed” the transition probability matrix using the rate matrix</h2>
<ul>
<li class="fragment">We will cover <strong>two</strong> approaches for constructing a transition probability matrix.</li>
<li class="fragment">The first is technically incorrect, but is widely used and easier to implement because it ignores compound transitions (i.e., multiple transitions within a cycle).</li>
<li class="fragment">You can get around these issues if you use a relatively short cycle length.<br>
</li>
</ul>
</section>
<section id="embed-the-transition-probability-matrix-using-the-rate-matrix-5" class="slide level2">
<h2>3. “Embed” the transition probability matrix using the rate matrix</h2>
<p>The two approaches</p>
<div class="nobullet">
<ul>
<li class="fragment">3a. Construct a transition probability matrix using rate-to-probability conversion formulas.</li>
<li class="fragment">3b. Embed the transition probability matrix using the rate matrix exponential (i.e., <span class="math inline">\(\mathbf{P}=e^{\mathbf{R}}\)</span>).</li>
</ul>
</div>
</section>
<section id="a.-rate-to-probability-conversion" class="slide level2">
<h2>3a. Rate-to-probability conversion</h2>
<p>The probability of transitioning from health state <span class="math inline">\(A\)</span> to health state <span class="math inline">\(B\)</span> is:</p>
<p><span class="math display">\[
p_{AB}= \frac{r_{AB}}{\sum_S r_{AS}}\big ( 1 - e^{-(\sum_S r_{AS}) t}\big )
\]</span> where <span class="math inline">\(S\)</span> captures all the health states (i.e., columns) in the transition rate matrix, and <span class="math inline">\(t\)</span> is the time-step (e.g., <span class="math inline">\(t=1\)</span> if 1 year, <span class="math inline">\(t=1/12\)</span> if one month, etc.).</p>
</section>
<section id="a.-rate-to-probability-conversion-1" class="slide level2">
<h2>3a. Rate-to-probability conversion</h2>
<p>Let’s build on our chronic heart failure example from earlier. Here is the transition rate matrix we constructed:</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">CHF</th>
<th style="text-align: right;">D_CHF</th>
<th style="text-align: right;">D_OTH</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CHF</td>
<td style="text-align: right;">-0.131</td>
<td style="text-align: right;">0.125</td>
<td style="text-align: right;">0.006</td>
</tr>
<tr class="even">
<td style="text-align: left;">D_CHF</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">D_OTH</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="a.-rate-to-probability-conversion-2" class="slide level2">
<h2>3a. Rate-to-probability conversion</h2>
<p>Let’s now calculate the probability of transitioning from the <strong>CHF</strong> state to <strong>D_CHF</strong> (death from heart failure).</p>
</section>
<section id="a.-rate-to-probability-conversion-3" class="slide level2">
<h2>3a. Rate-to-probability conversion</h2>
<p>Annual probability of transitioning from CHF to death from CHF:</p>
<p><span class="math display">\[
p_{\text{CHF,D_CHF}}= \frac{r_{\text{CHF,D_CHF}}}{r_{\text{CHF,D_CHF}} + r_{\text{CHF,D_OTH}}}\big ( 1 - e^{-(r_{\text{CHF,D_CHF}} + r_{\text{CHF,D_OTH}}) \times 1}\big )
\]</span></p>
<p>We can find each of these rates in our transition rate matrix…</p>
</section>
<section id="a.-rate-to-probability-conversion-4" class="slide level2">
<h2>3a. Rate-to-probability conversion</h2>
<p>Annual probability of transitioning from CHF to death from CHF:</p>
<p><span class="math display">\[
p_{\text{CHF,D_CHF}}= \frac{\color{red}{0.125}}{\color{red}{0.125}+\color{green}{0.006}}\big ( 1 - e^{-(\color{red}{0.125}+\color{green}{0.006}) \times 1}\big ) = 0.1172
\]</span></p>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top" style="margin-left: auto; margin-right: auto;">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">CHF</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">D_CHF</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">D_OTH</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CHF</td>
<td style="text-align: right;">-0.131</td>
<td style="text-align: left;"><span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: red !important;">0.125</span></td>
<td style="text-align: left;"><span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: green !important;">0.006</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">D_CHF</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: left;"><span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span></td>
<td style="text-align: left;"><span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">D_OTH</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: left;"><span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span></td>
<td style="text-align: left;"><span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="a.-rate-to-probability-conversion-5" class="slide level2">
<h2>3a. Rate-to-probability conversion</h2>
<p>Let’s now calculate the probability of transitioning from the <strong>CHF</strong> state to <strong>D_OTH</strong> (death from other causes).</p>
</section>
<section id="a.-rate-to-probability-conversion-6" class="slide level2">
<h2>3a. Rate-to-probability conversion</h2>
<p>Annual probability of transitioning from CHF to death from <strong>other causes</strong>:</p>
<p><span class="math display">\[
p_{\text{CHF,D_CHF}}= \frac{\color{green}{0.006}}{\color{red}{0.125}+\color{green}{0.006}}\big ( 1 - e^{-(\color{red}{0.125}+\color{green}{0.006}) \times 1}\big ) = 0.00562
\]</span></p>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top" style="margin-left: auto; margin-right: auto;">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">CHF</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">D_CHF</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">D_OTH</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CHF</td>
<td style="text-align: right;">-0.131</td>
<td style="text-align: left;"><span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: red !important;">0.125</span></td>
<td style="text-align: left;"><span style=" font-weight: bold;    color: white !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: green !important;">0.006</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">D_CHF</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: left;"><span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span></td>
<td style="text-align: left;"><span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">D_OTH</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: left;"><span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span></td>
<td style="text-align: left;"><span style="     color: black !important;border-radius: 4px; padding-right: 4px; padding-left: 4px; background-color: white !important;">0</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="a.-rate-to-probability-conversion-7" class="slide level2">
<h2>3a. Rate-to-probability conversion</h2>
<ul>
<li class="fragment"><p>We now have the quantities needed to complete the first row of our transition rate matrix.</p></li>
<li class="fragment"><p>Recall that the diagonal elements of the transition probability matrix are just 1 minus the other transition probabilities.</p></li>
</ul>
</section>
<section id="a.-rate-to-probability-conversion-8" class="slide level2">
<h2>3a. Rate-to-probability conversion</h2>
<p>Calculated transition probability matrix:</p>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top" style="margin-left: auto; margin-right: auto;">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">CHF</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">D_CHF</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">D_OTH</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CHF</td>
<td style="text-align: right;">0.8772</td>
<td style="text-align: right;">0.1172</td>
<td style="text-align: right;">0.0056</td>
</tr>
<tr class="even">
<td style="text-align: left;">D_CHF</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">1.0000</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">D_OTH</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">1.0000</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="b.-exponentiate-the-transition-rate-matrix" class="slide level2">
<h2>3b. Exponentiate the transition rate matrix</h2>
<ul>
<li class="fragment"><p>The most technically correct approach for “embedding” a transition probability matrix is using the rate matrix exponential.</p></li>
<li class="fragment"><p>This is a matrix analogue to the cellwise rate-to-probability matrix process we just went through.</p></li>
</ul>
</section>
<section id="b.-exponentiate-the-transition-rate-matrix-1" class="slide level2">
<h2>3b. Exponentiate the transition rate matrix</h2>
<p><span class="math display">\[
\mathbf{P} = e^{\mathbf{R}}
\]</span></p>
</section>
<section id="b.-exponentiate-the-transition-rate-matrix-2" class="slide level2">
<h2>3b. Exponentiate the transition rate matrix</h2>
<p>Pros:</p>
<ul>
<li class="fragment"><p>Embedding the transition probability matrix in this way ensures that the correct transition probabilities are calculated.</p></li>
<li class="fragment"><p>Without going into too many details, this approach ensures that some compound transitions are not “hidden” in the Markov cycle.</p></li>
<li class="fragment"><p>This ensures that our discrete time Markov model accurately represents the underlying continuous time process.</p></li>
</ul>
</section>
<section id="b.-exponentiate-the-transition-rate-matrix-3" class="slide level2">
<h2>3b. Exponentiate the transition rate matrix</h2>
<p>Cons:</p>
<ul>
<li class="fragment"><p>A major drawback is that this approach can create some “jumpover” states that are seemingly inconsistent with the underlying model (see blog for more).</p></li>
<li class="fragment"><p>Accounting for “hidden” transitions and jumpover states requires augmenting the transition probability matrix (again, see blog for details).</p></li>
</ul>
</section>
<section id="b.-exponentiate-the-transition-rate-matrix-4" class="slide level2">
<h2>3b. Exponentiate the transition rate matrix</h2>
<p>Cons, cont’d:</p>
<ul>
<li class="fragment"><p>Excel does not easily do matrix exponentiation, however you can use an approximation via a “power series expansion”</p></li>
<li class="fragment"><p>Modern (free) statistical software can easily exponentiate a matrix:</p></li>
</ul>
</section>
<section id="b.-exponentiate-the-transition-rate-matrix-5" class="slide level2">
<h2>3b. Exponentiate the transition rate matrix</h2>
<p>Cons, cont’d:</p>
<ul>
<li class="fragment"><p>Excel does not easily do matrix exponentiation, however you can use an approximation (we’ll do this in a case study).</p></li>
<li class="fragment"><p>Modern (free) statistical software can easily exponentiate a matrix:</p></li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a><span class="fu">library</span>(expm)</span>
<span id="cb1-2"><a></a>m_P <span class="ot">=</span> <span class="fu">expm</span>(m_R)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="b.-exponentiate-the-transition-rate-matrix-6" class="slide level2">
<h2>3b. Exponentiate the transition rate matrix</h2>
<p>For our chronic heart failure example, the exponentiated matrix yields a very similar answer to the first approach:</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">CHF</th>
<th style="text-align: right;">D_CHF</th>
<th style="text-align: right;">D_OTH</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CHF</td>
<td style="text-align: right;">0.8772</td>
<td style="text-align: right;">0.1172</td>
<td style="text-align: right;">0.0056</td>
</tr>
<tr class="even">
<td style="text-align: left;">D_CHF</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">1.0000</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">D_OTH</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">1.0000</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="so-where-are-we-now" class="slide level2">
<h2>So Where Are We Now?</h2>

<img data-src="images/paste-EFB5816C.png" class="r-stretch"></section>
<section id="so-where-are-we-now-1" class="slide level2">
<h2>So Where Are We Now?</h2>
<ul>
<li class="fragment"><p>By constructing our model using the “roots” of a transition rate matrix, we can incorporate disparate sources of information.</p></li>
<li class="fragment"><p>Facilitates country/region-specific background mortality.</p></li>
<li class="fragment"><p>Facilitates standardizing inputs measured at different time intervals.</p></li>
</ul>
</section>
<section id="so-where-are-we-now-2" class="slide level2">
<h2>So Where Are We Now?</h2>
<ul>
<li class="fragment"><p>Not all literature-based parameters operate on transition rates.</p></li>
<li class="fragment"><p>You will often find that the strategies you want to model have inputs based on odds ratios, relative risks, risk differences, etc.</p></li>
</ul>
</section>
<section id="chf-example-continued" class="slide level2">
<h2>CHF Example, Continued</h2>
<ul>
<li class="fragment"><p>Recall from earlier that we constructed two transition rate matrices:</p>
<ol type="1">
<li class="fragment">“Natural History” rate matrix</li>
<li class="fragment">Strategy A (“New Drug”) rate matrix based on a hazard ratio (for CHF mortality) of 0.8.</li>
</ol></li>
</ul>
</section>
<section id="chf-example-continued-1" class="slide level2">
<h2>CHF Example, Continued</h2>
<p>These two rate matrices can be used to construct the following transition probability matrices:</p>
<div style="font-size: 0.7em">
<div class="columns">
<div class="column">
<p>m_P_NH =</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">CHF</th>
<th style="text-align: right;">D_CHF</th>
<th style="text-align: right;">D_OTH</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CHF</td>
<td style="text-align: right;">0.8772</td>
<td style="text-align: right;">0.1172</td>
<td style="text-align: right;">0.0056</td>
</tr>
<tr class="even">
<td style="text-align: left;">D_CHF</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">1.0000</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">D_OTH</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">1.0000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div><div class="column">
<p>m_P_A =</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">CHF</th>
<th style="text-align: right;">D_CHF</th>
<th style="text-align: right;">D_OTH</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CHF</td>
<td style="text-align: right;">0.8994</td>
<td style="text-align: right;">0.0949</td>
<td style="text-align: right;">0.0057</td>
</tr>
<tr class="even">
<td style="text-align: left;">D_CHF</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">1.0000</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">D_OTH</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">1.0000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div></div>
</div>
</section>
<section id="chf-example-continued-2" class="slide level2">
<h2>CHF Example, Continued</h2>
<ul>
<li>Now suppose we wanted to model a second strategy (“B”) based on a randomized trial of another drug.</li>
<li>That trial reports an odds ratio (OR) of CHF death of 0.75.</li>
<li>The probability of CHF death in the placebo (control) arm in that trial was 0.15.<sup>1</sup></li>
</ul>
<aside><ol class="aside-footnotes"><li id="fn6"><p>Note this is slightly higher than the corresponding probability in our natural history transition probability matrix (0.1172), reflecting the fact that randomized trial participants are not necessarily representative of the entire population!</p></li></ol></aside></section>
<section id="chf-example-continued-3" class="slide level2">
<h2>CHF Example, Continued</h2>
<ul>
<li class="fragment">An odds ratio is based on the odds of an outcome happening, which is directly related to the probability.</li>
<li class="fragment">Odds = <span class="math inline">\(\frac{\text{Probability of Outcome}}{1 - \text{Probability of Outcome}}\)</span></li>
<li class="fragment">Odds Ratio = <span class="math inline">\(\frac{\text{Odds of outcome in exposed}}{\text{Odds of outcome in unexposed}}\)</span></li>
</ul>
</section>
<section id="chf-example-continued-4" class="slide level2">
<h2>CHF Example, Continued</h2>
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Important</strong></p>
</div>
<div class="callout-content">
<p>Not all literature-based parameters operate on the rate scale. Some operate on the probability scale!</p>
</div>
</div>
</div>
</section>
<section id="make-adjustments-to-mathbfp-as-needed." class="slide level2">
<h2>4. Make adjustments to <span class="math inline">\(\mathbf{P}\)</span> as needed.</h2>

<img data-src="images/paste-369710A3.png" class="r-stretch"></section>
<section id="make-adjustments-to-mathbfp-as-needed.-1" class="slide level2">
<h2>4. Make adjustments to <span class="math inline">\(\mathbf{P}\)</span> as needed.</h2>
<ul>
<li class="fragment">Constructing our final transition probability matrix—for natural history or more specifically for for a stratgey under consideration–may require further adjustment.</li>
<li class="fragment">We must be careful about the <em>scale</em> on which these parameters apply.</li>
<li class="fragment">Odds ratios, relative risks, and risk differences all operate on the <em>probability</em> scale.</li>
</ul>
</section>
<section id="make-adjustments-to-mathbfp-as-needed.-2" class="slide level2">
<h2>4. Make adjustments to <span class="math inline">\(\mathbf{P}\)</span> as needed.</h2>
<div style="font-size: 0.5em">
<table class="caption-top">
<colgroup>
<col style="width: 15%">
<col style="width: 54%">
<col style="width: 15%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th>Statistic</th>
<th>Evaluates</th>
<th>Range</th>
<th>Applicable Domain</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Rate</td>
<td><span class="math inline">\(\frac{\# \text{events in time period}}{\text{Total time period experienced by all subjects followed}}\)</span></td>
<td>0 to <span class="math inline">\(\infty\)</span></td>
<td>Rate matrix</td>
</tr>
<tr class="even">
<td>Hazard Ratio</td>
<td><span class="math inline">\(\frac{\text{Hazard rate of outcome in exposed}}{\text{Hazard rate of outcome in unexposed}}\)</span></td>
<td>0 to <span class="math inline">\(\infty\)</span></td>
<td>Rate matrix</td>
</tr>
<tr class="odd">
<td>Probability/risk</td>
<td><span class="math inline">\(\frac{\# \text{events in time period}}{\# \text{people followed for time period}}\)</span></td>
<td>0-1</td>
<td>Probability matrix</td>
</tr>
<tr class="even">
<td>Odds</td>
<td><span class="math inline">\(\frac{\text{Probability of Outcome}}{1 - \text{Probability of Outcome}}\)</span></td>
<td>0 to <span class="math inline">\(\infty\)</span></td>
<td>Probability matrix</td>
</tr>
<tr class="odd">
<td>Odds Ratio</td>
<td><span class="math inline">\(\frac{\text{Odds of outcome in exposed}}{\text{Odds of outcome in unexposed}}\)</span></td>
<td>0 to <span class="math inline">\(\infty\)</span></td>
<td>Probability matrix</td>
</tr>
<tr class="even">
<td>Relative Risk</td>
<td><span class="math inline">\(\frac{\text{Probability of outcome in exposed}}{\text{Probablity of outcome in unexposed}}\)</span></td>
<td>0 to <span class="math inline">\(\infty\)</span></td>
<td>Probability matrix</td>
</tr>
<tr class="odd">
<td>Risk Difference</td>
<td><span class="math inline">\(\text{Probability of outcome in exposed}-\text{Probablity of outcome in unexposed}\)</span></td>
<td>-1 to 1</td>
<td>Probability matrix</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="make-adjustments-to-mathbfp_s-as-needed." class="slide level2">
<h2>4. Make adjustments to <span class="math inline">\(\mathbf{P_s}\)</span> as needed.</h2>

<img data-src="images/paste-369710A3.png" class="r-stretch"></section>
<section id="chf-example-continued-5" class="slide level2">
<h2>CHF Example, Continued</h2>
<p>Let’s turn back to our CHF example.</p>
<ul>
<li class="fragment">Suppose we wanted to model a second strategy (“B”) based on a randomized trial of another drug.</li>
<li class="fragment">That trial reports an odds ratio (OR) of CHF death of 0.75.</li>
<li class="fragment">The probability of CHF death in the placebo (control) arm in that trial was 0.15.</li>
</ul>
</section>
<section id="chf-example-continued-6" class="slide level2">
<h2>CHF Example, Continued</h2>
<ul>
<li>We can convert an odds ratio to a relative risk (i.e., ratio of probabilities) if we know the baseline (unexposed) probability of the outcome, <span class="math inline">\(p_0\)</span>.</li>
<li>In this case we were able to find <span class="math inline">\(p_0=0.15\)</span> in the underlying clinical trial.</li>
<li>If we didn’t have this information, we might <strong>assume</strong> its the same (0.1172) as in our underlying natural history probability matrix<sup>1</sup></li>
</ul>
<aside><ol class="aside-footnotes"><li id="fn7"><p>Though note this is an assumption, so we should incorporate a lot of uncertainty around it in our model!</p></li></ol></aside></section>
<section id="chf-example-continued-7" class="slide level2">
<h2>CHF Example, Continued</h2>
<ul>
<li class="fragment">We can convert an odds ratio to a <strong>relative risk</strong> (RR).<sup>1</sup></li>
<li class="fragment"><span class="math inline">\(RR = \frac{\text{Probability of outcome in exposed}}{\text{Probablity of outcome in unexposed}} = \frac{p_1}{p_0} = \frac{OR}{(1-p_0+(p_0 \times OR))}\)</span></li>
<li class="fragment">A relative risk is the ratio of the probability of the outcome in the exposed group to the probability of the outcome in the unexposed group.</li>
</ul>
<aside><ol class="aside-footnotes"><li id="fn8"><p>If the incidence of the outcome is fairly rare (<span class="math inline">\(p_0&lt;0.10\)</span>), you will often see people simply use the OR as a RR. Source for conversion formula: <span class="citation" data-cites="zhangWhatRelativeRisk1998">Zhang and Yu (<a href="#/references" role="doc-biblioref" onclick="">1998</a>)</span></p></li></ol></aside></section>
<section id="chf-example-continued-8" class="slide level2">
<h2>CHF Example, Continued</h2>
<ul>
<li class="fragment"><span class="math inline">\(RR = \frac{p_1}{p_0}\)</span></li>
<li class="fragment"><span class="math inline">\(p_1 = RR \times p_0\)</span></li>
<li class="fragment"><span class="math inline">\(p_{D_{CHF}} = 0.75 \times .15 = 0.1125\)</span></li>
</ul>
</section>
<section id="chf-example-continued-9" class="slide level2">
<h2>CHF Example, Continued</h2>
<div class="quarto-layout-panel" data-layout-ncol="2" style="font-size: 0.55em">
<div class="quarto-layout-row">
<div class="cell quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="cell-output-display">
<table class="table caption-top" style="margin-left: auto; margin-right: auto;">
<caption>m_P =</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">CHF</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">D_CHF</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">D_OTH</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CHF</td>
<td style="text-align: right;">0.8772</td>
<td style="text-align: right;">0.1172</td>
<td style="text-align: right;">0.0056</td>
</tr>
<tr class="even">
<td style="text-align: left;">D_CHF</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">1.0000</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">D_OTH</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">1.0000</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="cell-output-display">
<table class="caption-top">
<caption>m_P_A =</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">CHF</th>
<th style="text-align: right;">D_CHF</th>
<th style="text-align: right;">D_OTH</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CHF</td>
<td style="text-align: right;">0.8994</td>
<td style="text-align: right;">0.0949</td>
<td style="text-align: right;">0.0057</td>
</tr>
<tr class="even">
<td style="text-align: left;">D_CHF</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">1.0000</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">D_OTH</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">1.0000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="cell-output-display">
<table class="caption-top">
<caption>m_P_B =</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">CHF</th>
<th style="text-align: right;">D_CHF</th>
<th style="text-align: right;">D_OTH</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CHF</td>
<td style="text-align: right;">0.8819</td>
<td style="text-align: right;">0.1125</td>
<td style="text-align: right;">0.0056</td>
</tr>
<tr class="even">
<td style="text-align: left;">D_CHF</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">1.0000</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">D_OTH</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">1.0000</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<p>Transition probability matrices (NH = Natural History; A = Strategy A; B = Strategy B)</p>
</div>
</div>
</div>
</section>
<section id="full-process" class="slide level2">
<h2>Full Process</h2>

<img data-src="images/paste-E2EB7E3D.png" class="r-stretch"></section></section>
<section>
<section id="nonstationary-transitions" class="title-slide slide level1 center">
<h1>Nonstationary Transitions</h1>

</section>
<section id="transition-dynamics" class="slide level2">
<h2>Transition Dynamics</h2>
<ul>
<li class="fragment">We have focused on “static” transition rate/probability matrices.</li>
<li class="fragment">Often, transitions vary as a function of time.</li>
</ul>
</section>
<section id="transition-dynamics-1" class="slide level2">
<h2>Transition Dynamics</h2>
<ul>
<li class="fragment">Nonstationary rates: background mortality rate rises with age.</li>
<li class="fragment">Nonstationary rates: transition to disease status may vary over different ages.</li>
<li class="fragment">Time-dependent event transitions: rate of adverse events after disease onset is higher in first cycle, lower in subsequent cycles.</li>
</ul>
</section>
<section id="age-varying-background-mortality" class="slide level2">
<h2>Age-Varying Background Mortality</h2>
<ul>
<li class="fragment">Useful data source is life table data. You used this in the Alive-Dead case study!</li>
<li class="fragment">May be available from vital statistics division in your country.</li>
<li class="fragment">Also available (by region) <a href="https://www.un.org/development/desa/pd/data/model-life-tables">from the UN</a> and other organizations.</li>
</ul>
</section>
<section id="section" class="slide level2" data-background-image="media/life-table-un.png" data-background-size="contain">
<h2></h2>
</section>
<section id="nonstationary-rates" class="slide level2">
<h2>Nonstationary Rates</h2>
<ul>
<li class="fragment">You may have other parameters that vary by age.
<ul>
<li class="fragment">Disease specific mortality rate:</li>
</ul></li>
</ul>

<img data-src="images/paste-EA4566AA.png" class="r-stretch"><p>Source: <span class="citation" data-cites="russellWhatPertussisMortality2016">Russell et al. (<a href="#/references" role="doc-biblioref" onclick="">2016</a>)</span></p>
</section>
<section id="nonstationary-rates-1" class="slide level2">
<h2>Nonstationary Rates</h2>
<ul>
<li class="fragment">You may have other parameters that vary by age.
<ul>
<li class="fragment">Disease specific mortality rate:</li>
<li class="fragment">Age-specific intervention rates/probabilities</li>
</ul></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/paste-0AB76A08.png" class="quarto-figure quarto-figure-center" height="300"></p>
</figure>
</div>
<p>Source: <span class="citation" data-cites="russellWhatPertussisMortality2016">Russell et al. (<a href="#/references" role="doc-biblioref" onclick="">2016</a>)</span></p>
</section>
<section id="nonstationary-rates-2" class="slide level2">
<h2>Nonstationary Rates</h2>
<ul>
<li class="fragment">It is straightforward to incorporate these dynamics into a Markov model.</li>
<li class="fragment">Essentially, you recalculate the transition probability matrix in each cycle.</li>
<li class="fragment">This works long as the underlying rates/probabilities change by age.</li>
<li class="fragment">Amua can handle all of this for you, provided you enter the age-specific “lookup table” in the model (just as with background mortality).</li>
</ul>
</section>
<section id="other-transition-dynamics" class="slide level2">
<h2>Other Transition Dynamics</h2>
<ul>
<li class="fragment">Suppose, instead, that event/transition rates, costs, quality of life vary over the course of a disease or other process in our model.</li>
<li class="fragment">Example: cost, quality of life weight, or risk of adverse event (e.g., death) is different in first year after disease onset, and changes thereafter.</li>
<li class="fragment">These types of dynamics are more challenging to implement – but you can often do it!</li>
</ul>
</section>
<section id="other-transition-dynamics-1" class="slide level2">
<h2>Other Transition Dynamics</h2>
<ul>
<li class="fragment"><p>One option is to simply build a decision tree around events that occur at higher rates shortly after disease onset, surgery, drug initiation, etc.</p></li>
<li class="fragment"><p>The decision tree can follow people until they reach a “steady state” — then the Markov model can pick up from there.</p></li>
</ul>
</section>
<section id="other-transition-dynamics-2" class="slide level2">
<h2>Other Transition Dynamics</h2>
<ul>
<li class="fragment"><p>Another option is “tunnel states” — simply expand the health state to follow people over the first few cycles of onset.</p></li>
<li class="fragment"><p>Tunnel states are “non-markovian,” so they need to be added once you have the transition probability matrix defined.</p></li>
</ul>
</section>
<section id="tunnel-states-healthy-sick-dead" class="slide level2">
<h2>Tunnel States: Healthy, Sick, Dead</h2>
<ul>
<li class="fragment">Let’s take a simple healthy, sick, dead model.</li>
<li class="fragment">Illness onset rate = 0.0314</li>
<li class="fragment">Background mortality rate = 0.0094</li>
<li class="fragment">Illness increases the risk of death by a hazard ratio of 5.45.</li>
</ul>
</section>
<section id="tunnel-states-healthy-sick-dead-1" class="slide level2">
<h2>Tunnel States: Healthy, Sick, Dead</h2>
<p>Transition rate matrix: <span class="math inline">\(\mathbf{R}\)</span></p>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top" style="margin-left: auto; margin-right: auto;">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">H</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">S</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">D</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">H</td>
<td style="text-align: right;">-0.0408</td>
<td style="text-align: right;">0.0314</td>
<td style="text-align: right;">0.0094</td>
</tr>
<tr class="even">
<td style="text-align: left;">S</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">-0.0513</td>
<td style="text-align: right;">0.0513</td>
</tr>
<tr class="odd">
<td style="text-align: left;">D</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0000</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="tunnel-states-healthy-sick-dead-2" class="slide level2">
<h2>Tunnel States: Healthy, Sick, Dead</h2>
<p>Transition probability matrix: <span class="math inline">\(\exp(\mathbf{R})\)</span></p>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top" style="margin-left: auto; margin-right: auto;">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">H</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">S</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">D</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">H</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.01</td>
</tr>
<tr class="even">
<td style="text-align: left;">S</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">0.05</td>
</tr>
<tr class="odd">
<td style="text-align: left;">D</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="tunnel-states-healthy-sick-dead-3" class="slide level2">
<h2>Tunnel States: Healthy, Sick, Dead</h2>
<ul>
<li class="fragment"><p>Now suppose that the probability of death from disease varies by time since disease onset.</p>
<ul>
<li class="fragment">0.08 in first year</li>
<li class="fragment">0.06 in second year</li>
<li class="fragment">0.04 in third year onwards</li>
</ul></li>
<li class="fragment"><p>We can add tunnel states to our transition probability matrix to accomodate this.</p></li>
</ul>
</section>
<section id="tunnel-states-healthy-sick-dead-4" class="slide level2">
<h2>Tunnel States: Healthy, Sick, Dead</h2>
<ul>
<li class="fragment">Here is the new transition probability matrix.</li>
<li class="fragment">Notice how the tunnel states “force” people to transition either to the next disease state if they do not die of the disease in the cycle.</li>
</ul>
<div style="font-size: 0.8em">
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top" style="margin-left: auto; margin-right: auto;">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">H</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">S1</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">S2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">S</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">D</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">H</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.01</td>
</tr>
<tr class="even">
<td style="text-align: left;">S1</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.92</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.08</td>
</tr>
<tr class="odd">
<td style="text-align: left;">S2</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.94</td>
<td style="text-align: right;">0.06</td>
</tr>
<tr class="even">
<td style="text-align: left;">S</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">0.04</td>
</tr>
<tr class="odd">
<td style="text-align: left;">D</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="tunnel-states-healthy-sick-dead-5" class="slide level2 smaller">
<h2>Tunnel States: Healthy, Sick, Dead</h2>
<ul>
<li class="fragment">If we run out the Markov trace for five cycles, here are the results.</li>
</ul>
<div style="font-size: 0.75em">
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top" style="margin-left: auto; margin-right: auto;">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">cycle</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">H</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">S1</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">S2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">S</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">S_total</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">D</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1000</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">960</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">922</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">22</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">885</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">35</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">849</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">102</td>
<td style="text-align: right;">49</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">815</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">72</td>
<td style="text-align: right;">121</td>
<td style="text-align: right;">63</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section></section>
<section id="references" class="title-slide slide level1 smaller scrollable">
<h1>References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-gidwaniEstimatingTransitionProbabilities2020" class="csl-entry" role="listitem">
Gidwani, Risha, and Louise B. Russell. 2020. <span>“Estimating <span>Transition Probabilities</span> from <span>Published Evidence</span>: <span>A Tutorial</span> for <span>Decision Modelers</span>.”</span> <em>PharmacoEconomics</em> 38 (11): 1153–64. <a href="https://doi.org/10.1007/s40273-020-00937-z">https://doi.org/10.1007/s40273-020-00937-z</a>.
</div>
<div id="ref-russellWhatPertussisMortality2016" class="csl-entry" role="listitem">
Russell, Louise B., Sri Ram Pentakota, Cristiana Maria Toscano, Ben Cosgriff, and Anushua Sinha. 2016. <span>“What Pertussis Mortality Rates Make Maternal Acellular Pertussis Immunization Cost-Effective in Low-and Middle-Income Countries? A Decision Analysis.”</span> <em>Clinical Infectious Diseases</em> 63 (suppl_4): S227–35.
</div>
<div id="ref-zhangWhatRelativeRisk1998" class="csl-entry" role="listitem">
Zhang, Jun, and Kai F. Yu. 1998. <span>“What’s the <span>Relative Risk</span>?<span>A Method</span> of <span>Correcting</span> the <span>Odds Ratio</span> in <span>Cohort Studies</span> of <span>Common Outcomes</span>.”</span> <em>JAMA</em> 280 (19): 1690–91. <a href="https://doi.org/10.1001/jama.280.19.1690">https://doi.org/10.1001/jama.280.19.1690</a>.
</div>
</div>


</section>


    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="../vchem.png" class="slide-logo"></p>
<div class="footer footer-default">
<p><a href="../index.html">Back to Website</a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'fade',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'fade',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>